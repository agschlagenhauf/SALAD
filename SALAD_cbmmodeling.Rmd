---
title: "SALAD_cbmmodeling"
author: "Lara Wieland"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  word_document: default
  html_document:
    df_print: paged
  pdf_document: default
fig_caption: yes
---

This script:
- loads necessary packages
- imports data (data_params: summary of 6 (or 8 if you count scaling+beta) free parameters exported from Matlab cbm section 6
                dat_physio_behav: most of behavioral data + physio data in wide format for AD + HC sample
                data_physio_behav: same but only HC sample)
- check parameter distributions and table
- plots exploratory analyses on WM capacity mediating cortisol impact on behavioral performance (p_correct)


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=F}
rm(list = ls()) 

if (!require(ggplot2)) install.packages("ggplot2")
if (!require(lme4)) install.packages("lme4")
if (!require(corrplot)) install.packages("corrplot")
if (!require(PerformanceAnalytics)) install.packages("PerformanceAnalytics")
if (!require(kableExtra)) install.packages('kableExtra')
if (!require(Hmisc)) install.packages('Hmisc')


library("ggplot2")
library("lme4")
library("corrplot")
library("PerformanceAnalytics")
library("kableExtra")
library("Hmisc")

```

# Data Import
```{r, include=FALSE}
## NECESSARY TO RUN THIS FIRST:

load('/cloud/project/dataframes/dat_physio_behav.rda')
load('/cloud/project/dataframes/data_physio_behav.rda')
load('/cloud/project/dataframes/dat_physio_behav_red.rda')
load('/cloud/project/dataframes/data_physio_behav_red.rda')
load('/cloud/project/dataframes/data_params.rda')

```


## Modeling Preparations and Checks
```{r}

# dichotomize HC dataset by WM capacity (num_backward)
data_physio_behav$wm_cap <- dicho(data_physio_behav$num_backward, dich.by = "median", as.num = TRUE)
data_physio_behav$wm_cap <-factor(data_physio_behav$wm_cap, labels=c("low WM", "high WM"))

# dichotomize HC dataset by lifetime stress (PSS)
data_physio_behav$lt_stress <- dicho(data_physio_behav$PSS_Total, dich.by = "median", as.num = TRUE)
data_physio_behav$lt_stress <-factor(data_physio_behav$lt_stress, labels=c("low lifetime stress", "high lifetime stress"))


median_params <- data_params %>% summarise_if(is.numeric, median)
sd_params <- data_params %>% summarise_if(is.numeric, sd)

params_sum <- rbind(median_params, sd_params)

kable(
  params_sum,
  padding=-1L,
  col.names = c("Alpha Win","Alpha Loss","Beta Win","Beta Loss","Scaling Win","Scaling Loss", "Beta + Scaling Win", "Beta + Scaling Loss")
) %>%
  row_spec(2,italic=TRUE)   %>%
  kable_styling("striped",full_width = F,font_size = 12) %>%
  footnote("Italic:SD", general_title = "Parameters have been transformed to be interpretable: Alpha (1-0), Beta (0-Inf)")

hist(data_params$al_win)
hist(data_params$al_loss)


##################### CORRELATION MODELING params with each other

res2 <- rcorr(as.matrix(data_params))

res <- cor(data_params)

corrplot(res2$r,method = "number", type="upper", 
         p.mat = res2$P, sig.level = 0.05, insig = "blank")

chart.Correlation(data_params)

```

```{r}

##################### MODELING and BEHAV p_correct 
# calculate from modeling params beta parameters + scaling factor

data_physio_behav <- data_physio_behav  %>% mutate(bet_ST_loss = abs(bet_loss) + abs(sc_bet_loss))
data_physio_behav <- data_physio_behav  %>% mutate(bet_ST_win = abs(bet_win) + abs(sc_bet_win))

# plots for modeling params of DU_scaling_bothCond (winning model with different betas for ST vs. CT) and p_correct
mod_pcorrect_plot_1 <- ggscatter(na.omit(data_physio_behav), x = "bet_win", y = "diff_STCT",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Beta Win", ylab = "Difference ST-CT") + facet_wrap("lt_stress")
mod_pcorrect_plot_1

mod_pcorrect_plot_2 <- ggscatter(na.omit(data_physio_behav), x = "bet_loss", y = "diff_STCT",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Beta Loss", ylab = "Difference ST-CT") + facet_wrap("lt_stress")
mod_pcorrect_plot_2

mod_pcorrect_plot_3 <- ggscatter(na.omit(data_physio_behav), x = "sc_bet_win", y = "diff_STCT",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Scaling Beta Win", ylab = "Difference ST-CT") + facet_wrap("lt_stress")
mod_pcorrect_plot_3

mod_pcorrect_plot_4 <- ggscatter(na.omit(data_physio_behav), x = "sc_bet_loss", y = "diff_STCT",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Scaling Beta Loss", ylab = "Difference ST-CT") + facet_wrap("lt_stress")
mod_pcorrect_plot_4

# scaling beta + beta = ST correlated with p_correct ST; just beta correlated with p_correct CT

mod_pcorrect_plot_5 <- ggscatter(data_physio_behav, x = "sc_bet_win", y = "p_correct_ST",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Beta + Beta Scaling Win", ylab = "Correct Performance ST")
mod_pcorrect_plot_5

mod_pcorrect_plot_6 <- ggscatter(data_physio_behav, x = "sc_bet_loss", y = "p_correct_ST",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Beta + Beta Scaling Loss", ylab = "Correct Performance ST")
mod_pcorrect_plot_6

mod_pcorrect_plot_7 <- ggscatter(data_physio_behav, x = "bet_win", y = "p_correct_CT",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Beta Win", ylab = "Correct Performance CT")
mod_pcorrect_plot_7

mod_pcorrect_plot_8 <- ggscatter(data_physio_behav, x = "bet_loss", y = "p_correct_CT",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Beta Loss", ylab = "Correct Performance CT")
mod_pcorrect_plot_8

mod_pcorrect_plot_9 <- ggscatter(data_physio_behav, x = "sc_bet_win", y = "p_correct_ST",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Scaling + Beta Win", ylab = "Correct Performance ST")
mod_pcorrect_plot_9

mod_pcorrect_plot_10 <- ggscatter(data_physio_behav, x = "sc_bet_loss", y = "p_correct_ST",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Scaling + Beta Loss", ylab = "Correct Performance ST")
mod_pcorrect_plot_10

# ttest for scaling against 0
scwin.ttest <- stats::t.test(data_physio_behav$sc_win)
scloss.ttest <- stats::t.test(data_physio_behav$sc_loss)

# ttest for scaling plus betas against 0
scbetwin.ttest <- stats::t.test(data_physio_behav$sc_bet_win)
scbetloss.ttest <- stats::t.test(data_physio_behav$sc_bet_loss)

# ttest for betas against 0
betwin.ttest <- stats::t.test(data_physio_behav$bet_win)
betloss.ttest <- stats::t.test(data_physio_behav$bet_loss)

# paired ttest for betas with and w/o scaling against each other
pairedwin.ttest <- stats::t.test(data_physio_behav$bet_win,data_physio_behav$sc_win, paired = TRUE)
pairedloss.ttest <- stats::t.test(data_physio_behav$bet_loss,data_physio_behav$sc_loss, paired = TRUE)

##################### MODELING WM AND NP

neuropsych_params <- select(data_physio_behav,tmt_a, tmt_b, dsst, num_forward, num_backward, IQ_WST, al_win, al_loss, bet_win, bet_loss, sc_win, sc_loss, sc_bet_win, sc_bet_loss)

res3 <- rcorr(as.matrix(neuropsych_params))

corrplot(res3$r,method = "color", type="upper", 
         p.mat = res3$P, sig.level = 0.05, insig = "blank")


p.mod.betiq1 <- ggscatter(data_all, x = "IQ_WST", y = "bet_win", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Cognitive capacities", ylab = "Inverse decision temperature (beta win)")
p.mod.betiq1

p.mod.betiq2 <- ggscatter(data_all, x = "IQ_WST", y = "bet_loss", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Cognitive capacities", ylab = "Inverse decision temperature (beta loss)")
p.mod.betiq2

```
